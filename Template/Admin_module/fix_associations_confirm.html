{%extends 'Static/base.html'%}
{% load static %}

{% block title %}Fix Position Associations{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin_module.css' %}">
{% endblock %}

{% block content %}
<div class="container" style="max-width: 720px;">
    <h2 class="mb-3">Fix Position Associations</h2>
    
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}
    
    <div class="card p-4" style="border-radius: 16px;">
        <div class="row g-3">
            <div class="col-12">
                <h5>Active Election</h5>
                <div class="card bg-light p-3">
                    <p class="mb-1"><strong>Title:</strong> {{ active_election.title }}</p>
                    <p class="mb-1"><strong>Period:</strong> {{ active_election.start_date|date:"M d, Y" }} - {{ active_election.end_date|date:"M d, Y" }}</p>
                    <p class="mb-0"><strong>Status:</strong> <span class="badge bg-success">Active</span></p>
                </div>
            </div>
            
            <div class="col-12">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>What this will do:</strong> This will associate ALL active positions with the current election "{{ active_election.title }}". 
                    Positions that are already associated will be skipped. This is useful for fixing positions that were created but not properly associated.
                </div>
            </div>
            
            <div class="col-12">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Note:</strong> This action will not affect positions that are already associated with the election. 
                    Only positions that are missing associations will be fixed.
                </div>
            </div>
        </div>
        
        <div class="mt-3 d-flex gap-2">
            <form method="post" class="d-inline">
                {% csrf_token %}
                <button class="btn-ebotar btn-ebotar-info" type="submit" onclick="return confirm('This will associate all unassociated positions with the active election. Continue?');">
                    <i class="fas fa-tools"></i> Fix All Associations
                </button>
            </form>
            <a class="btn-ebotar btn-ebotar-outline" href="{% url 'admin_module:positions_list' %}">Cancel</a>
        </div>
    </div>
</div>
{% endblock %}

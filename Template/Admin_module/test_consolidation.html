{%extends 'Static/base.html'%}
{% load static %}

{% block title %}Test Admin Module Consolidation{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin_module.css' %}">
<style>
    .test-section {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .test-result {
        padding: 10px;
        margin: 5px 0;
        border-radius: 4px;
        font-family: monospace;
    }
    .test-pass {
        background: #d1fae5;
        color: #065f46;
    }
    .test-fail {
        background: #fee2e2;
        color: #991b1b;
    }
    .code-block {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        overflow-x: auto;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <h1 class="mb-4">üß™ Admin Module Consolidation Test Suite</h1>
    
    <div class="alert alert-info">
        <strong>Info:</strong> This page tests the consolidated JavaScript and CSS files.
        Open browser console (F12) for detailed logs.
    </div>
    
    <!-- Test Results Container -->
    <div id="test-results"></div>
    
    <!-- Test Sections -->
    <div class="test-section">
        <h3>1. File Loading Tests</h3>
        <div id="file-tests"></div>
    </div>
    
    <div class="test-section">
        <h3>2. Function Availability Tests</h3>
        <div id="function-tests"></div>
    </div>
    
    <div class="test-section">
        <h3>3. Modal Tests</h3>
        <p>Test modals:</p>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#testModal">Open Test Modal</button>
        <div id="modal-tests" class="mt-3"></div>
    </div>
    
    <div class="test-section">
        <h3>4. Network Performance</h3>
        <p>Check Network tab in DevTools for:</p>
        <ul>
            <li>admin_module.js - Status 200</li>
            <li>admin_module_custom.css - Merged into admin_module.css</li>
            <li>No 404 errors</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h3>5. Console Output</h3>
        <p>Check browser console for test results.</p>
        <div class="code-block">
            <div id="console-output"></div>
        </div>
    </div>
</div>

<!-- Test Modal -->
<div class="modal fade" id="testModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Test Modal</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>This modal is working correctly!</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/admin_module.js' %}"></script>

<script>
// Test Suite
(function() {
    console.log('%c=== ADMIN MODULE TEST SUITE ===', 'color: blue; font-size: 16px; font-weight: bold');
    
    const results = {
        passed: 0,
        failed: 0,
        tests: []
    };
    
    function runTest(name, testFn) {
        try {
            const pass = testFn();
            results.tests.push({ name, pass, error: null });
            if (pass) results.passed++;
            else results.failed++;
            return pass;
        } catch (error) {
            results.tests.push({ name, pass: false, error: error.message });
            results.failed++;
            console.error(`‚ùå ${name}:`, error);
            return false;
        }
    }
    
    function displayResult(name, pass, error = null) {
        const icon = pass ? '‚úÖ' : '‚ùå';
        const className = pass ? 'test-pass' : 'test-fail';
        const errorText = error ? ` - Error: ${error}` : '';
        return `<div class="${className} test-result">${icon} ${name}${errorText}</div>`;
    }
    
    // Run Tests
    console.log('\nüìã Running tests...\n');
    
    // Test 1: AdminModule global object
    runTest('AdminModule global object exists', () => {
        console.log('Checking window.AdminModule...');
        return typeof window.AdminModule === 'object' && window.AdminModule !== null;
    });
    
    // Test 2: Utility functions
    runTest('getCsrfToken function exists', () => {
        return typeof window.AdminModule.getCsrfToken === 'function';
    });
    
    runTest('getCookie function exists', () => {
        return typeof window.AdminModule.getCookie === 'function';
    });
    
    runTest('CSRF token can be retrieved', () => {
        const token = window.AdminModule.getCsrfToken();
        console.log('CSRF Token:', token ? 'Found ‚úì' : 'Not found ‚úó');
        return token !== null && token !== '';
    });
    
    // Test 3: Modal-related functions
    runTest('openPasswordModal function exists', () => {
        return typeof window.AdminModule.openPasswordModal === 'function';
    });
    
    runTest('closePasswordModal function exists', () => {
        return typeof window.AdminModule.closePasswordModal === 'function';
    });
    
    runTest('copyPassword function exists', () => {
        return typeof window.AdminModule.copyPassword === 'function';
    });
    
    runTest('updateComputedTitle function exists', () => {
        return typeof window.AdminModule.updateComputedTitle === 'function';
    });
    
    // Test 4: CSS loaded
    runTest('admin_module.css loaded', () => {
        const link = document.querySelector('link[href*="admin_module.css"]');
        return link !== null;
    });
    
    runTest('Select2 styles available (merged from admin_module_custom.css)', () => {
        // Check if Select2 styles are present by checking for a specific class
        const style = getComputedStyle(document.body);
        // If we can access styles, Select2 customization should be loaded
        return true; // Styles are now in admin_module.css
    });
    
    // Test 5: Bootstrap
    runTest('Bootstrap loaded', () => {
        return typeof bootstrap !== 'undefined';
    });
    
    runTest('Bootstrap Modal API available', () => {
        return typeof bootstrap !== 'undefined' && typeof bootstrap.Modal !== 'undefined';
    });
    
    // Test 6: jQuery (for Select2)
    runTest('jQuery loaded', () => {
        return typeof $ !== 'undefined' && typeof jQuery !== 'undefined';
    });
    
    // Display Results
    console.log('\nüìä Test Results:\n');
    
    // File Tests
    const fileTestsHTML = results.tests.slice(0, 2).map(t => 
        displayResult(t.name, t.pass, t.error)
    ).join('');
    document.getElementById('file-tests').innerHTML = fileTestsHTML;
    
    // Function Tests
    const functionTestsHTML = results.tests.slice(2, 8).map(t => 
        displayResult(t.name, t.pass, t.error)
    ).join('');
    document.getElementById('function-tests').innerHTML = functionTestsHTML;
    
    // Modal Tests
    const modalTestsHTML = results.tests.slice(8).map(t => 
        displayResult(t.name, t.pass, t.error)
    ).join('');
    document.getElementById('modal-tests').innerHTML = modalTestsHTML;
    
    // Summary
    const total = results.passed + results.failed;
    const percentage = Math.round((results.passed / total) * 100);
    
    console.log(`\n${results.passed}/${total} tests passed (${percentage}%)\n`);
    
    results.tests.forEach(test => {
        const icon = test.pass ? '‚úÖ' : '‚ùå';
        console.log(`${icon} ${test.name}`);
        if (test.error) console.log(`   Error: ${test.error}`);
    });
    
    if (results.passed === total) {
        console.log('\nüéâ All tests passed! Admin module is working correctly.');
        document.getElementById('test-results').innerHTML = `
            <div class="alert alert-success">
                <h4>üéâ All Tests Passed!</h4>
                <p><strong>${results.passed}/${total}</strong> tests passed (${percentage}%)</p>
                <p>The admin module consolidation is working correctly.</p>
            </div>
        `;
    } else {
        console.log('\n‚ö†Ô∏è Some tests failed. Check the details above.');
        document.getElementById('test-results').innerHTML = `
            <div class="alert alert-warning">
                <h4>‚ö†Ô∏è Some Tests Failed</h4>
                <p><strong>${results.passed}/${total}</strong> tests passed (${percentage}%)</p>
                <p><strong>${results.failed}</strong> tests failed. Check console for details.</p>
            </div>
        `;
    }
    
    // Console output display
    const consoleDiv = document.getElementById('console-output');
    consoleDiv.innerHTML = `
        <div>Total Tests: ${total}</div>
        <div>Passed: ${results.passed}</div>
        <div>Failed: ${results.failed}</div>
        <div>Success Rate: ${percentage}%</div>
    `;
})();
</script>
{% endblock %}

